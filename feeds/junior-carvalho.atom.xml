<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>PythonClub</title><link href="http://pythonclub.com.br/" rel="alternate"></link><link href="http://pythonclub.com.br/feeds/junior-carvalho.atom.xml" rel="self"></link><id>http://pythonclub.com.br/</id><updated>2016-11-23T17:30:00-02:00</updated><entry><title>Deploy rápido e simples com Dokku</title><link href="http://pythonclub.com.br/deploy-rapido-simples-com-dokku.html" rel="alternate"></link><published>2016-11-23T17:30:00-02:00</published><updated>2016-11-23T17:30:00-02:00</updated><author><name>Júnior Carvalho</name></author><id>tag:pythonclub.com.br,2016-11-23:deploy-rapido-simples-com-dokku.html</id><summary type="html">&lt;p&gt;Sempre busquei alternativas para deploy simples como o heroku. Vou mostrar neste passo-a-passo uma forma simples e rápida utilizando o &lt;a href="http://dokku.viewdocs.io/dokku/"&gt;Dokku&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href="http://dokku.viewdocs.io/dokku/"&gt;Dokku&lt;/a&gt; é a menor implementação PaaS que você já viu. De uma forma simples e rápida consegue-se configurar um servidor para deploy. Se existe alguma dúvida sobre PaaS, SaaS, etc., uma pesquisa rápida no google vai retornar várias referências.&lt;/p&gt;
&lt;p&gt;Nesse exemplo vou utilizar uma vps básica na &lt;a href="https://m.do.co/c/2f45101e7ccf"&gt;DigitalOcean&lt;/a&gt;. Uma máquina 512 MB / 20 Gb/ 1 CPU, rodando Ubuntu Server 16.04.1. É possível criar uma máquina já com &lt;a href="http://dokku.viewdocs.io/dokku/"&gt;Dokku&lt;/a&gt; instalado e pré-configurado mas vou fazer com uma máquina 'limpa' para servir de base para outras vps.&lt;/p&gt;
&lt;h3&gt;Instalando&lt;/h3&gt;
&lt;p&gt;Com o servidor em execução vamos acessar via ssh pelo terminal. No caso de utilizar OS Windows, utilize o &lt;a href="http://www.putty.org/"&gt;putty&lt;/a&gt; para acessar o servidor.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh [ip-do-servidor] -l root
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;No primeiro acesso confirme com yes o questionamento sobre a autenticidade. No caso da &lt;a href="https://m.do.co/c/2f45101e7ccf"&gt;DigitalOcean&lt;/a&gt; vai ser solicitado a mudança de senha nesse primeiro acesso.&lt;/p&gt;
&lt;p&gt;Seguindo a documentação do &lt;a href="http://dokku.viewdocs.io/dokku/"&gt;Dokku&lt;/a&gt; vamos realizar a instação. Este processo demora +- uns 10 minutos.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wget https://raw.githubusercontent.com/dokku/dokku/v0.7.2/bootstrap.sh
sudo DOKKU_TAG=v0.7.2 bash bootstrap.sh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Finalizado o script de instação vamos adicionar a chave publica de nosso usuário de desenvolvimento para conseguir fazer o deploy no servidor recem criado.&lt;/p&gt;
&lt;h3&gt;Chaves&lt;/h3&gt;
&lt;p&gt;Na nossa máquina de desenvolvimento, vamos checar se nosso usuário tem uma chave pública:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ls -al ~/.ssh
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Por padrão os arquivos das chaves públicas podem ser:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;id_dsa.pub&lt;/li&gt;
&lt;li&gt;id_ecdsa.pub&lt;/li&gt;
&lt;li&gt;id_ed25519.pub&lt;/li&gt;
&lt;li&gt;id_rsa.pub&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;No meu caso eu tenho o id_rsa.pub, então vou ler o conteúdo, seleciona-lo e copiar:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;cat ~/.ssh/id_rsa.pub
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Para gerar a chave: (caso não exista nenhum arquivo .pub na pasta ~/.ssh)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;ssh-keygen -t rsa
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Aceite as três opções pedidas por default. (não inserir password)
Para OS Windows achei este artigo. &lt;a href="http://adrianorosa.com/blog/seguranca/como-criar-ssh-key-pair-windows.html"&gt;ssh Windows&lt;/a&gt; (não testei)&lt;/p&gt;
&lt;h3&gt;Inserindo a chave pública no servidor&lt;/h3&gt;
&lt;p&gt;Com nossa chave pública copiada (ctrl+c) vamos abrir o browser e digitar o ip do nosso servidor. Vai aparecer uma tela como a da imagem a seguir:
&lt;figure style="float:center;"&gt;
&lt;img src="/images/juniorcarvalho/dokku-setup.jpg"&gt;
&lt;/figure&gt;
&lt;/br&gt;
No campo Public Key, colamos nossa chave (Ctrl+V) e depois é so clicar em Finish Setup. Feito isto você vai ser redirecionado para página da documentação do &lt;a href="http://dokku.viewdocs.io/dokku/"&gt;Dokku&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Criando nossa APP&lt;/h3&gt;
&lt;p&gt;No terminal, conectado no nosso servidor:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku apps:create [nome-app]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;No meu caso:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku apps:create fjfundo
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Para listar as apps existentes:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku apps
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Quando você cria um novo aplicativo, por padrão o &lt;a href="http://dokku.viewdocs.io/dokku/"&gt;dokku&lt;/a&gt; nao fornece nenhum banco de dados como MySql ou PostgreSQL. É preciso instalar plugins. &lt;a href="http://dokku.viewdocs.io/dokku/"&gt;Dokku&lt;/a&gt; tem plugins oficiais para banco de dados. Neste passo-a-passo vou utilizar o PostgreSQL.&lt;/p&gt;
&lt;h3&gt;Instalando o plugin postgres e configurando o serviço de banco de dados&lt;/h3&gt;
&lt;p&gt;No terminal, conectado no nosso servidor:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo dokku plugin:install https://github.com/dokku/dokku-postgres.git
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Criando o serviço postgres: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku postgres:create [nome-servico]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;No meu caso:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku postgres:create fjfundo-database
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Vamos criar o link entre os serviços de banco de dados e nossa app.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku postgres:link [nome-servico] [nome-app]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;No meu caso:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku postgres:link fjfundo-database fjfundo
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Configurando e executando nosso primeiro deploy.&lt;/h3&gt;
&lt;p&gt;Na nossa máquina cliente vamos configurar o git para fazer o primeiro deploy.
Vamos adicionar nosso repositorio remoto dokku da seguinte forma:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git remote add dokku dokku@[ip-do-servidor]:[nome-app]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;No meu caso:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git remote add dokku dokku@xxx.xxx.xxx.xxx:fjfundo
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;No meu caso antes de fazer o deploy eu tenho que configurar algumas variáveis de ambiente como DEBUG e SECRET_KEY. Para esta configuração executo os comandos no servidor. Vou seguir a documentação existente em &lt;a href="http://dokku.viewdocs.io/dokku/configuration/environment-variables/"&gt;Environment Variables&lt;/a&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku config:set fjfundo DEBUG=&amp;#39;False&amp;#39;
dokku config:set fjfundo SECRET_KEY=&amp;#39;sua secret_key&amp;#39;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Para listar as variáveis de ambiente de nossa app:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku config [nome da app]
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Feito isto vamos ao nosso primeiro deploy: ( na nossa máquina cliente/dev)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;git push dokku master --force
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Pronto! Agora é so acessar nossa aplicação. No final do deploy o &lt;a href="http://dokku.viewdocs.io/dokku/"&gt;dokku&lt;/a&gt; mostra a url de conexão. Caso precise obter a url use o comando no servidor:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku url [nome-app]
&lt;/pre&gt;&lt;/div&gt;


&lt;h3&gt;Criando as tabelas do banco de dados&lt;/h3&gt;
&lt;p&gt;Nossa app está no ar mais ainda não tem as tabelas de nossa base de dados.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;dokku run fjfundo python manage.py migrate
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Troque fjfundo pelo nome da sua app.&lt;/p&gt;
&lt;h3&gt;Considerações finais&lt;/h3&gt;
&lt;p&gt;Ainda estou estudando e aprendendo a utilizar o &lt;a href="http://dokku.viewdocs.io/dokku/"&gt;dokku&lt;/a&gt;. Utilizo apenas em ambiente de desenvolvimento mas pretendo utilizar em produção. 
Ainda tenho muito que aprender e fica aqui meu email, joseadolfojr@gmail.com, para quem tiver alguma dúvida e quizer também contribuir para meus estudos.&lt;/p&gt;</summary><category term="python"></category><category term="deploy"></category><category term="django"></category><category term="dokku"></category></entry></feed>