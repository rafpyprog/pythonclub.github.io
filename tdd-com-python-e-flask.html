<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PythonClub, ">
    <meta name="theme-color" content="#101212">

        <link rel="alternate"  href="http://pythonclub.com.br/feeds/all.atom.xml" type="application/atom+xml" title="PythonClub Full Atom Feed"/>
        <link rel="alternate" href="http://pythonclub.com.br/feeds/all.rss.xml" type="application/rss+xml" title="PythonClub Full RSS Feed"/>

    <link rel="shortcut icon" href="http://pythonclub.com.br/theme/images/favicon.ico" >

            <title>TDD com Python e Flask por Eduardo Cuducos // #PythonClub // </title>

    <meta property="fb:app_id" content="1487080281503641" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="TDD com Python e Flask" />
    <meta property="og:site_name" content="PythonClub" />
    <meta property="og:url" content="http://pythonclub.com.br/tdd-com-python-e-flask.html" />
    <meta property="og:description" content="Baseado na palestra que ofereci no encontro do Grupy-SP, em 12 de março de 2016. O código dessa atividade está disponível no meu GitHub. A ideia desse exercício é introduzir a ideia de test driven development (TDD) usando Python e Flask — digo isso pois a aplicação final desse “tutorial” não …" />
    <meta property="og:image" content="http://res.cloudinary.com/diu8g9l0s/image/upload/v1400201393/pythonclub/logo_275x130.png" />

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.3.0/pure-min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.min.css">
    <link rel="stylesheet" href="http://pythonclub.com.br/theme/css/pure.css">
    <link rel="stylesheet" href="http://pythonclub.com.br/theme/css/custom.css">

    <link rel="stylesheet" href="http://pythonclub.com.br/theme/css/pygments.css">



    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-50935105-1', 'pythonclub.com.br');
      ga('require', 'linkid', 'linkid.js');
      ga('send', 'pageview');

    </script>
    <!-- transifex -->
    <!-- <script type="text/javascript">  -->
    <!-- window.liveSettings = {  -->
    <!--     api_key: "f8fd260a9bdc4e9195c80e31416bb254",  -->
    <!--     picker: "bottom-right",  -->
    <!--     detectlang: true,  -->
    <!--     autocollect: true  -->
    <!-- };  -->
    <!-- </script>  -->
    <!-- <script type="text/javascript" src="//cdn.transifex.com/live.js"></script>  -->
    <!-- end transifex -->
    <meta name="google-site-verification" content="XQc_QtnTecI9nxAfplXGtECCpZQDwbDRcn7pyDVa1LE" />
</head>

<body>
<div class="pure-g-r" id="layout">
    <div class="sidebar sidebar-article pure-u">
        <header class="header-article">
            <hgroup>
                <a href="http://pythonclub.com.br/author/eduardo-cuducos.html" title="See posts by Eduardo Cuducos">
                        <img class="article-avatar" alt="Eduardo Cuducos" src="https://www.gravatar.com/avatar/35f0a285fbf11a7155bb23695c5a270e">
                </a>
                <h2 class="article-info">Eduardo Cuducos</h2>
    			<ul class="author-social">
                    <li>
                        <a target="_blank" href="https://github.com/cuducos">
                            <i class="fa fa-lg fa-fw fa-github"></i>
                            <strong>Github</strong>
                        </a>
                    </li>
                    <li>
                        <a target="_blank" href="https://twitter.com/cuducos">
                            <i class="fa fa-lg fa-fw fa-twitter"></i>
                            <strong>Twitter</strong>
                        </a>
                    </li>
                    <li>
                        <a target="_blank" href="http://www.linkedin.com/in/cuducos">
                            <i class="fa fa-lg fa-fw fa-linkedin"></i>
                            <strong>Linkedin</strong>
                        </a>
                    </li>
                    <li>
                        <a target="_blank" href="http://cuducos.me">
                            <i class="fa fa-lg fa-fw fa-globe"></i>
                            <strong>Site</strong>
                        </a>
                    </li>
                </ul>
                    <small class="about-author">Sociólogo, geek, cozinheiro e fã de esportes.</small>
                <h5>Publicado em:</h5>
                <p>Mon 14 March 2016</p>
                <a href="/">&larr;Home</a>
            </hgroup>
        </header>
    </div>
    <div class="pure-u">
        <div class="content">
            <section class="post">
                <header class="post-header">
                    <h1>TDD com Python e Flask</h1>
                        <p class="post-meta">
                            // Tags                                 <a class="post-category" href="http://pythonclub.com.br/tag/tdd.html">tdd</a>
                                <a class="post-category" href="http://pythonclub.com.br/tag/test-driven-development.html">test driven development</a>
                                <a class="post-category" href="http://pythonclub.com.br/tag/flask.html">flask</a>
                        </p>
                </header>
            </section>
            <blockquote>
<p>Baseado na palestra que ofereci no <a href="http://www.meetup.com/Grupy-SP/events/228437612/">encontro</a> do <a href="https://groups.google.com/forum/#!forum/grupy-sp">Grupy-SP</a>, em 12 de março de 2016. O código dessa atividade está disponível no <a href="https://github.com/cuducos/grupy-python-tdd-flask">meu GitHub</a>.</p>
</blockquote>
<p>A ideia desse exercício é introduzir a ideia de <em>test driven development</em> (TDD) usando <a href="http://http://python.org">Python</a> e <a href="http://flask.pocoo.org/">Flask</a> — digo isso pois a aplicação final desse “tutorial” não é nada avançada, tampouco funcional. E isso se explica por dois motivos: primeiro, o foco é sentir o que é o <em>driven</em> do TDD, ou seja, como uma estrutura de <em>tests first</em> (sempre começar escrevendo os testes, e não a aplicação) pode guiar o processo de desenvolvimento; e, segundo, ser uma atividade rápida, de mais ou menos 1h.</p>
<p>Em outras palavras, não espere aprender muito de Python ou Flask. Aqui se concentre em sentir a diferença de utilizar um método de programar. Todo o resto é secundário.</p>
<h2>1. Preparando o ambiente</h2>
<h3>Requisitos</h3>
<p>Para esse exercício usaremos o Python versão 3.5.1 com o framework Flask versão 0.10.1. É recomendado, mas não necessário, usar um <a href="http://virtualenv.readthedocs.org">virtualenv</a>.</p>
<blockquote>
<p>Como o código é bem simples, não acho que você vá ter muitos problemas se utilizar uma versão mais antiga do Python (ou mesmo do Flask). Em todo caso, em um detalhe ou outro você pode se deparar com mensagens distintas se utilizar o Python 2.</p>
</blockquote>
<p>Você pode verificar a versão do seu Python com esse comando:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> python --version                                                                                    
</pre></div>


<p>Dependendo da sua instalação, pode ser que você tenha que usar <code>python3</code> ao invés de <code>python</code> — ou seja, o comando todo deve ser <code>python3 --version</code>. O resultado deve ser esse:</p>
<div class="highlight"><pre><span></span><span class="err">Python 3.5.1</span>
</pre></div>


<p>E instalar o Flask assim:</p>
<div class="highlight"><pre><span></span>$ pip install Flask
</pre></div>


<p>O <code>pip</code> é um gerenciador de pacotes do Python. Ele vem instalado por padrão nas versões mais novas do Python. Dependendo da sua instalação, pode ser que você tenha que usar <code>pip3</code> ao invés de <code>pip</code> — ou seja, o comando todo deve ser <code>pip3 install Flask</code>. Com esse comando ele vai instalar o Flask e qualquer dependência que o Flask tenha:</p>
<div class="highlight"><pre><span></span><span class="go">Collecting Flask</span>
<span class="go">Collecting Jinja2&gt;=2.4 (from Flask)</span>
<span class="go">  Using cached Jinja2-2.8-py2.py3-none-any.whl</span>
<span class="go">Collecting itsdangerous&gt;=0.21 (from Flask)</span>
<span class="go">Collecting Werkzeug&gt;=0.7 (from Flask)</span>
<span class="go">  Using cached Werkzeug-0.11.4-py2.py3-none-any.whl</span>
<span class="go">Collecting MarkupSafe (from Jinja2&gt;=2.4-&gt;Flask)</span>
<span class="go">Installing collected packages: MarkupSafe, Jinja2, itsdangerous, Werkzeug, Flask</span>
<span class="go">Successfully installed Flask-0.10.1 Jinja2-2.8 MarkupSafe-0.23 Werkzeug-0.11.4 itsdangerous-0.24</span>
</pre></div>


<h3>Arquivos</h3>
<p>Vamos usar, nesse exercício, basicamente 2 arquivos:</p>
<ul>
<li><code>app.py</code>: onde criamos nossa aplicação web;</li>
<li><code>tests.py</code>: onde escrevemos os testes que guiarão o desenvolvimento da aplicação, e que, também, garantirão que ela funcione.</li>
</ul>
<h2>2. Criando a base dos testes</h2>
<p>No arquivo <code>tests.py</code> vamos usar o módulo <a href="https://docs.python.org/3.5/library/unittest.html">unittest</a>, que já vem instalado por padrão no Python.</p>
<p>Criaremos uma estrutura básica para que, toda vez que esse arquivo seja executado, o <code>unittest</code> se encarregue de encontrar todos os nossos testes e rodá-los.</p>
<p>Vamos começar escrevendo com um exemplo fictício: testes para um método que ainda não criamos, um método que calcule números fatoriais. A ideia é só entender como escreveremos testes em um arquivo (<code>tests.py</code>) para testar o que escreveremos no outro arquivo (<code>app.py</code>).</p>
<p>A estrutura básica a seguir cria um caso de teste da <code>unittest</code> e, quando executada, teste nosso método <code>fatorial(numero)</code> para todos os números de 0 até 6:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>


<span class="k">class</span> <span class="nc">TestFatorial</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_fatorial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fatorial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fatorial</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fatorial</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fatorial</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fatorial</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">24</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fatorial</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">120</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fatorial</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="mi">720</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>Se você conhece um pouco de inglês, pode ler o código em voz alta, ele é quase auto explicativo: importamos o módulo <em>unittest</em> (linha 1), criamos um objeto que é um caso de teste do método fatorial (linha 4), escrevemos um método de teste (linha 6) e esse método se assegura de que o retorno de <code>fatorial(numero)</code> é o resultado que esperamos (linhas 5 a 11).</p>
<p>Agora podemos rodar os testes assim:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> python testes.py
</pre></div>


<p>Veremos uma mensagem de erro, <code>NameError</code>, pois não definimos nossa função <code>fatorial(numero)</code>:</p>
<div class="highlight"><pre><span></span><span class="n">E</span>
<span class="o">======================================================================</span>
<span class="n">ERROR</span><span class="p">:</span> <span class="n">test_fatorial</span> <span class="p">(</span><span class="n">__main__</span><span class="p">.</span><span class="n">TestSimples</span><span class="p">)</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="k">call</span> <span class="k">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="ss">&quot;tests.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">7</span><span class="p">,</span> <span class="k">in</span> <span class="n">test_fatorial</span>
    <span class="k">self</span><span class="p">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fatorial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">NameError</span><span class="p">:</span> <span class="n">name</span> <span class="s1">&#39;fatorial&#39;</span> <span class="k">is</span> <span class="k">not</span> <span class="k">defined</span>

<span class="c1">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">001</span><span class="n">s</span>

<span class="n">FAILED</span> <span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>Tudo bem, a ideia não é brincar com matemática agora. Mas vamos criar essa função lá no <code>app.py</code> só para ver como a gente pode “integrar” esses dois arquivos — ou seja, fazer o <code>tests.py</code> testar o que está em <code>app.py</code>.</p>
<p>Vamos adicionar essas linhas ao <code>app.py</code>:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fatorial</span><span class="p">(</span><span class="n">numero</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">numero</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">numero</span> <span class="o">*</span> <span class="n">fatorial</span><span class="p">(</span><span class="n">numero</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>E adicionar essa linha no topo do <code>tests.py</code>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">fatorial</span>
</pre></div>


<p>Agora, rodando os testes vemos que a integração entre <code>app.py</code> e <code>tests.py</code> está funcionando:</p>
<div class="highlight"><pre><span></span><span class="p">.</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">000</span><span class="n">s</span>

<span class="n">OK</span>
</pre></div>


<p>Ótimo. Chega de matemática, vamos ao TDD com Flask, um caso muito mais tangível do que encontramos no nosso dia-a-dia.</p>
<h2>3. Primeiros passos para a aplicação web</h2>
<h3>Criando um servidor web</h3>
<p>Como nosso foco é começar uma aplicação web, podemos descartar os testes e o método fatorial que criamos no passo anterior. Ao invés disso, vamos escrever um teste simples, para ver se conseguimos fazer o Flask criar um servidor web.</p>
<p>Descarte tudo do <code>tests.py</code> substituindo o conteúdo do arquivo por essas linhas:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">meu_web_app</span>


<span class="k">class</span> <span class="nc">TestHome</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">meu_web_app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">unittest</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>


<p>Esse arquivo agora faz quatro coisas referentes a nossa aplicação web:</p>
<ol>
<li>Importa o objeto <code>meu_web_app</code> (que ainda não criamos) do nosso arquivo <code>app.py</code>;</li>
<li>Cria uma instância da nossa aplicação web específica para nossos testes (é o método <code>meu_web_app.test_client()</code>, cujo retorno batizamos de <code>app</code>);</li>
<li>Tenta acessar a “raíz” da nossa aplicação — ou seja, se essa aplicação web estivesse no servidor <code>pythonclub.com.br</code> estaríamos acessando <a href="http://pythonclub.com.br/">http://pythonclub.com.br/</a>.</li>
<li>Verifica se, ao acessar esse endereço, ou seja, se ao fazer a requisição HTTP para essa URL, temos como resposta o código 200, que representa sucesso.</li>
</ol>
<p>Os códigos de status de requisição HTTP mais comuns são o <code>200</code> (sucesso), <code>404</code> (página não encontrada) e <code>302</code> (redirecionamento) — mas a <a href="https://pt.wikipedia.org/wiki/Lista_de_códigos_de_status_HTTP">lista completa</a> é muito maior que isso. </p>
<p>De qualquer forma não conseguiremos rodar esses testes. O interpretador do Python vai nos retornar um erro:</p>
<div class="highlight"><pre><span></span><span class="ne">ImportError</span><span class="p">:</span> <span class="n">cannot</span> <span class="kn">import</span> <span class="nn">name</span> <span class="s1">&#39;meu_web_app&#39;</span>
</pre></div>


<p>Então vamos criar o objeto <code>meu_web_app</code> lá no <code>app.py</code>. Descartamos tudo que tínhamos lá substituindo o contéudo do arquivo por essas linhas:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">meu_web_app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">()</span>
</pre></div>


<p>Apenas estamos importando a classe principal do Flask, e criando uma instância dela. Em outras palavras, estamos começando a utilizar o framework.</p>
<p>E agora o erro muda:</p>
<div class="highlight"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;tests.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">meu_web_app</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/cuducos/Desktop/flask/app.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">3</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
    <span class="n">meu_web_app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">()</span>
<span class="ne">TypeError</span><span class="p">:</span> <span class="fm">__init__</span><span class="p">()</span> <span class="n">missing</span> <span class="mi">1</span> <span class="n">required</span> <span class="n">positional</span> <span class="n">argument</span><span class="p">:</span> <span class="s1">&#39;import_name&#39;</span>
</pre></div>


<p>Importamos nosso <code>meu_web_app</code>, mas quando instanciamos o Flask temos um problema. Qual problema? O erro nos diz: quando tentamos chamar <code>Flask()</code> na linha 3 do <code>app.py</code> está faltando um argumento posicional obrigatório (<em>missing 1 required positional argument</em>). Estamos chamando <code>Flask()</code> sem nenhum argumento. O erro ainda nos diz que o que falta é um nome (<em>import_name</em>). Vamos batizar nossa instância com um nome:</p>
<div class="highlight"><pre><span></span><span class="n">meu_web_app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="err">`</span><span class="n">meu_web_app</span><span class="err">`</span><span class="p">)</span>
</pre></div>


<p>E agora temos uma nova mensagem de erro, ou seja, progresso!</p>
<blockquote>
<p>Eu amo testes que falham! A melhor coisa é uma notificação em vermelho me dizendo que os testes estão falhando. Isso significa que eu tenho testes e que eles estão funcionando!</p>
<p>— <a href="https://twitter.com/rochacbruno">Bruno Rocha</a></p>
</blockquote>
<div class="highlight"><pre><span></span><span class="n">F</span>
<span class="o">======================================================================</span>
<span class="n">FAIL</span><span class="p">:</span> <span class="n">test_get</span> <span class="p">(</span><span class="n">__main__</span><span class="p">.</span><span class="n">TestHome</span><span class="p">)</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="k">call</span> <span class="k">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="ss">&quot;tests.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">10</span><span class="p">,</span> <span class="k">in</span> <span class="n">test_get</span>
    <span class="k">self</span><span class="p">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="p">)</span>
<span class="n">AssertionError</span><span class="p">:</span> <span class="mi">200</span> <span class="o">!=</span> <span class="mi">404</span>

<span class="c1">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">015</span><span class="n">s</span>

<span class="n">FAILED</span> <span class="p">(</span><span class="n">failures</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<p>Temos uma aplicação web rodando, mas quando tentamos acessar a raíz dela, ela nos diz que a página não está definida, não foi encontrada (é o que nos diz o código <code>404</code>).</p>
<h3>Criando nossa primeira página</h3>
<p>O Flask facilita muito a criação de aplicações web. De forma simplificada a qualquer método Python pode ser atribuída uma URL. Isso é feito com um decorador:</p>
<div class="highlight"><pre><span></span><span class="err">@meu_web_app.route(&#39;/&#39;)</span>
<span class="err">def pagina_inicial():</span>
<span class="err">    return &#39;&#39;</span>
</pre></div>


<p>Adicionando essas linhas no <code>app.py</code>, os testes passam:</p>
<div class="highlight"><pre><span></span><span class="p">.</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">1</span> <span class="n">test</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">013</span><span class="n">s</span>

<span class="n">OK</span>
</pre></div>


<p>Se a curiosidade for grande, esse artigo (em inglês) explica direitinho como o <code>Flask.route(rule, **options)</code> funciona: <a href="http://ains.co/blog/things-which-arent-magic-flask-part-1.html">Things which aren't magic - Flask and @app.route</a>.</p>
<p>Para garantir que tudo está certinho mesmo, podemos adicionar mais um teste. Queremos que a resposta do servidor seja um HTML:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">meu_web_app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">content_type</span><span class="p">)</span>
</pre></div>


<p>Rodando os testes, veremos que agora temos dois testes. E ambos passam!</p>
<h3>Eliminando repetições</h3>
<p>Repararam que duas linhas se repetem nos métodos <code>test_get()</code> e <code>test_content_type()</code>?</p>
<div class="highlight"><pre><span></span><span class="n">app</span> <span class="o">=</span> <span class="n">meu_web_app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</pre></div>


<p>Podemos usar um método especial da classe <code>unittest.TestCase</code> para reaproveitar essas linhas. O método <code>TestCase.setUp()</code> é executado ao iniciar cada teste, e através do <code>self</code> podemos acessar objetos de um método a partir de outro método:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestHome</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">meu_web_app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">content_type</span><span class="p">)</span>
</pre></div>


<p>Não vamos precisar nesse exemplo, mas o método <code>TestCase.tearDown()</code> é executado ao fim de cada teste (e não no início, como a <code>setUp()</code>). Ou seja, se precisar repetir algum comando sempre após cada teste, a <code>unittest</code> também faz isso para você.</p>
<h2>4. Preenchendo a página</h2>
<h3>Conteúdo como resposta</h3>
<p>Temos um servidor web funcionando, mas não vemos nada na nossa aplicação web. Podemos verificar isso em três passos rápidos:</p>
<p>Primeiro adicionamos essas linhas ao <code>app.py</code> para que, quando executarmos o <code>app.py</code> (mas não quando ele for importado no <code>tests.py</code>), a aplicação web seja iniciada:</p>
<div class="highlight"><pre><span></span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">meu_web_app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<p>Depois executamos o arquivo:</p>
<div class="highlight"><pre><span></span><span class="gp">$</span> python app.py
</pre></div>


<p>Assim vemos no terminal essa mensagem:</p>
<div class="highlight"><pre><span></span><span class="err"> * Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)</span>
</pre></div>


<p>Se acessarmos essa URL no nosso navegador, podemos ver a aplicação rodando: <a href="http://127.0.0.1:5000/">http://127.0.0.1:5000/</a>.</p>
<p>E veremos que realmente não há nada, é uma página em branco.</p>
<p>Vamos mudar isso! Vamos construir o que seria uma página individual, mostrando quem a gente é. Na minha vou querer que esteja escrito (ao menos), meu nome. Então vamos escrever um teste para isso:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;Eduardo Cuducos&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
</pre></div>


<p>Feito isso, teremos uma nova mensagem de erro nos testes:</p>
<div class="highlight"><pre><span></span><span class="n">TypeError</span><span class="o">:</span> <span class="n">a</span> <span class="n">bytes</span><span class="o">-</span><span class="n">like</span> <span class="n">object</span> <span class="k">is</span> <span class="n">required</span><span class="o">,</span> <span class="n">not</span> <span class="s1">&#39;str&#39;</span>
</pre></div>


<p>Essa mensagem nos diz que estamos comparando uma <em>string</em> com um objeto que é de outro tipo, que é representado por <em>bytes</em>. Não é isso que queremos. Como explicitamente passamos para o teste uma <em>string</em> com nosso nome, podemos assumir que é o <code>self.response.data</code> que vem codificado em <em>bytes</em>. Vamos decodificá-lo para <em>string</em>.</p>
<blockquote>
<p><em>Bytes precisam ser decodificados para string (método <code>decode</code>). Strings precisam ser codificados para bytes para então mandarmos o conteúdo para o disco, para a rede (método <code>encode</code>).</em></p>
<p>— <a href="http://henriquebastos.net">Henrique Bastos</a></p>
</blockquote>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;Eduardo Cuducos&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</pre></div>


<p>Assim temos uma nova mensagem de erro:</p>
<div class="highlight"><pre><span></span><span class="c">AssertionError: &#39;Eduardo Cuducos&#39; not found in &quot;b&#39;&#39;&quot;</span>
</pre></div>


<p>Nossa página está vazia, logo o teste não consegue encontrar meu nome na página. Vamos resolver isso lá no <code>app.py</code>:</p>
<div class="highlight"><pre><span></span><span class="nd">@meu_web_app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pagina_inicial</span><span class="p">():</span>
    <span class="k">return</span> <span class="s1">&#39;Eduardo Cuducos&#39;</span>
</pre></div>


<p>Agora temos os testes passando, e podemos verificar isso vendo que temos o nome na tela do navegador.</p>
<div class="highlight"><pre><span></span><span class="p">...</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">3</span> <span class="n">tests</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">015</span><span class="n">s</span>

<span class="n">OK</span>
</pre></div>


<h3>Apresentando o conteúdo com HTML</h3>
<p>O Python e o Flask cuidam principalmente do back-end da apliacação web — o que ocorre “por trás dos panos” no lado do servidor.</p>
<p>Mas temos também o front-end, que é o que o usuário vê, a interface com a qual o usuário interage. Normalmente o front-end é papel de outras linguagens, como o HTML, o CSS e o JavaScript.</p>
<p>Vamos começar com um HTML básico, criando a pasta <code>templates</code> e dentro dela o arquivo <code>home.html</code>:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Eduardo Cuducos<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Eduardo Cuducos<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Sociólogo, geek, cozinheiro e fã de esportes.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>Se a gente abrir essa página no navegador já podemos ver que ela é um pouco menos do que o que a gente tinha antes. Então vamos alterar nosso <code>test_content()</code> para garantir que ao invés de termos somente a <em>string</em> com nosso nome na aplicação, tempos esse template renderizado:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">response_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;title&gt;Eduardo Cuducos&lt;/title&gt;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">response_str</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;Eduardo Cuducos&lt;/h1&gt;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">response_str</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;Sociólogo, &#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">response_str</span><span class="p">))</span>
</pre></div>


<p>Assim vemos nossos testes falharem:</p>
<div class="highlight"><pre><span></span>F..
======================================================================
FAIL: test_content (__main__.TestHome)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;tests.py&quot;, line 18, in test_content
    self.assertIn(&#39;<span class="nt">&lt;title&gt;</span>Eduardo Cuducos<span class="nt">&lt;/title&gt;</span>&#39;, str(self.response.data))
AssertionError: &#39;<span class="nt">&lt;title&gt;</span>Eduardo Cuducos<span class="nt">&lt;/title&gt;</span>&#39; not found in &quot;b&#39;Eduardo Cuducos&#39;&quot;

----------------------------------------------------------------------
Ran 3 tests in 0.017s

FAILED (failures=1)
</pre></div>


<p>Criamos um HTML, mas ainda não estamos pedindo para o Flask utilizá-lo. Temos nossa <code>home.html</code> dentro da pasta <code>templates</code> pois é justamente lá que o Flask vai buscar templates. Sabendo disso, podemos fazer nosso método <code>index()</code> retornar não a string, mas o template:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span>

<span class="err">…</span>

<span class="nd">@meu_web_app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pagina_inicial</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">)</span>
</pre></div>


<p>Assim voltamos a ter testes passando — e a página fica um pouco mais apresentável.</p>
<h3>Formatando o conteúdo com CSS</h3>
<p>Para não perder muito o foco do Python, TDD e Flask, vamos utilizar um framework CSS que se chama <a href="http://getbootstrap.com/">Bootstrap</a>. Incluindo o CSS desse framework no nosso HTML, e utilizando algumas classes especificas dele, conseguimos dar uma cara nova para nossa aplicação.</p>
<p>Vamos escrever um teste para verificar se estamos mesmo carregando o Bootstrap:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_bootstrap_css</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">response_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;bootstrap.min.css&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>
</pre></div>


<p>Os testes falham. Temos que linkar o CSS do Bootstrap em nosso HTML. Ao invés de baixar o Bootstrap, vamos utilizar o <a href="http://getbootstrap.com/getting-started/#download-cdn">servidor CDN que eles mesmo recomendam</a>. É só incluir essa linha no <code>&lt;head&gt;</code> do nosso HTML:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css&quot;</span><span class="p">&gt;</span>
</pre></div>


<p>Agora, com os testes passando, vamos utilizar as classes do Bootstrap para formatar melhor nossa página. Vamos retirar nosso <code>&lt;h1&gt;</code> e <code>&lt;p&gt;</code> e, ao invés disso, partir do componente <a href="http://getbootstrap.com/components/#jumbotron">Jumbotron</a> fazendo algumas pequenas alterações:</p>
<div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;jumbotron&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://avatars.githubusercontent.com/u/4732915?v=3&amp;s=128&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;Eduardo Cuducos&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;img-circle&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Eduardo Cuducos<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Sociólogo, geek, cozinheiro e fã de esportes.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary btn-lg&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;http://twitter.com/cuducos&quot;</span> <span class="na">role</span><span class="o">=</span><span class="s">&quot;button&quot;</span><span class="p">&gt;</span>Me siga no Twitter<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>


<p>Com essa página “incrementada” podemos ainda refinar nossos testes, garantindo que sempre temos a foto e o link:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_profile_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">response_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;img src=&quot;&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;class=&quot;img-circle&quot;&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">test_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">response_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;href=&quot;http://twitter.com/cuducos&quot;&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&gt;Me siga no Twitter&lt;/a&gt;&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>
</pre></div>


<p>Pronto, agora temos uma página formatada para mostrar para nossos colegas, com todos os testes passando:</p>
<div class="highlight"><pre><span></span><span class="p">......</span>
<span class="c1">----------------------------------------------------------------------</span>
<span class="n">Ran</span> <span class="mi">6</span> <span class="n">tests</span> <span class="k">in</span> <span class="mi">0</span><span class="p">.</span><span class="mi">024</span><span class="n">s</span>

<span class="n">OK</span>
</pre></div>


<h2>5. Conteúdos dinâmicos</h2>
<h3>Passando variáveis para o contexto do template</h3>
<p>O problema da nossa página é que ela é estática. Vamos usar o Python e o Flask para que quando a gente acesse <code>/cuducos</code> a gente veja a minha página, com meus dados. Mas caso a gente acesse <code>/z4r4tu5tr4</code>, a gente veja o conteúdo referente ao outro Eduardo que palestrou comigo no Grupy.</p>
<p>Antes de mudar nossas URLS, vamos refatorar nossa aplicação e — importantíssimo! — os testes tem que continuar passando. A ideia é evitar que o conteúdo esteja “fixo” no template. Vamos fazer o conteúdo ser passado do método <code>pagina_principal()</code> para o template.</p>
<p>A ideia é extrair todo o conteúdo do nosso HTML criando um dicionário no <code>app.py</code>:</p>
<div class="highlight"><pre><span></span><span class="n">CUDUCOS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nome&#39;</span><span class="p">:</span> <span class="s1">&#39;Eduardo Cuducos&#39;</span><span class="p">,</span>
           <span class="s1">&#39;descricao&#39;</span><span class="p">:</span> <span class="s1">&#39;Sociólogo, geek, cozinheiro e fã de esportes.&#39;</span><span class="p">,</span>
           <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://twitter.com/cuducos&#39;</span><span class="p">,</span>
           <span class="s1">&#39;nome_url&#39;</span><span class="p">:</span> <span class="s1">&#39;Twitter&#39;</span><span class="p">,</span>
           <span class="s1">&#39;foto&#39;</span><span class="p">:</span> <span class="s1">&#39;https://avatars.githubusercontent.com/u/4732915?v=3&amp;s=128&#39;</span><span class="p">}</span>
</pre></div>


<p>E, na sequência, usar esse dicionário para passar uma variável chamada <code>perfil</code> para o contexto do template:</p>
<div class="highlight"><pre><span></span><span class="nd">@meu_web_app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pagina_inicial</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">perfil</span><span class="o">=</span><span class="n">CUDUCOS</span><span class="p">)</span>
</pre></div>


<p>Por fim, vamor utilizar, ao invés das minhas informações, a variável <code>perfil</code> no template:</p>
<div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>{{ perfil.nome }}<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;jumbotron&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;{{ perfil.foto }}&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;{{ perfil.nome }}&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;img-circle&quot;</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>{{ perfil.nome }}<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>{{ perfil.descricao }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;btn btn-primary btn-lg&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ perfil.url }}&quot;</span>
            <span class="na">role</span><span class="o">=</span><span class="s">&quot;button&quot;</span><span class="p">&gt;</span>Me siga no {{ perfil.nome_url }}<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>


<p>Feito isso, temos todas as informações disponíveis no nosso ambiente Python, e não mais no HTML. E os testes nos garantem que no final das contas, para o usuário, a página não mudou — ou seja, estamos mostrando as informações corretamente.</p>
<h3>Criando conteúdo dinâmico</h3>
<p>Vamos agora criar um outro dicionário para termos informações de outras pessoas. E vamos juntar todos os perfis em uma variável chamada <code>PERFIS</code>:</p>
<div class="highlight"><pre><span></span><span class="n">MENDES</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;nome&#39;</span><span class="p">:</span> <span class="s1">&#39;Eduardo Mendes&#39;</span><span class="p">,</span>
          <span class="s1">&#39;descricao&#39;</span><span class="p">:</span> <span class="s1">&#39;Apaixonado por software livre e criador de lambdas.&#39;</span><span class="p">,</span>
          <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;http://github.com/z4r4tu5tr4&#39;</span><span class="p">,</span>
          <span class="s1">&#39;nome_url&#39;</span><span class="p">:</span> <span class="s1">&#39;GitHub&#39;</span><span class="p">,</span>
          <span class="s1">&#39;foto&#39;</span><span class="p">:</span> <span class="s1">&#39;https://avatars.githubusercontent.com/u/6801122?v=3&amp;s=128&#39;</span><span class="p">}</span>

<span class="n">PERFIS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cuducos&#39;</span><span class="p">:</span> <span class="n">CUDUCOS</span><span class="p">,</span>
          <span class="s1">&#39;z4r4tu5tr4&#39;</span><span class="p">:</span> <span class="n">MENDES</span><span class="p">}</span>
</pre></div>


<p>Agora, se utilizarmos nossa <code>pagina_principal()</code> com o primeiro perfil, nossos testes passam. Podemos passar o outro perfil e ver, no navegador, que já temos a nossa página com outras informações:</p>
<div class="highlight"><pre><span></span><span class="nd">@meu_web_app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">pagina_inicial</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">,</span> <span class="n">perfil</span><span class="o">=</span><span class="n">PERFIS</span><span class="p">[</span><span class="s1">&#39;z4r4tu5tr4&#39;</span><span class="p">])</span>
</pre></div>


<p>Mas se rodarmos os testes assim, veremos duas falhas:</p>
<div class="highlight"><pre><span></span>.F..F.
======================================================================
FAIL: test_content (__main__.TestHome)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;tests.py&quot;, line 19, in test_content
    self.assertIn(&#39;<span class="nt">&lt;title&gt;</span>Eduardo Cuducos<span class="nt">&lt;/title&gt;</span>&#39;, str(response_str))
AssertionError: &#39;<span class="nt">&lt;title&gt;</span>Eduardo Cuducos<span class="nt">&lt;/title&gt;</span>&#39; not found in &#39;<span class="cp">&lt;!DOCTYPE HTML&gt;</span>\n<span class="nt">&lt;html&gt;</span>\n  <span class="nt">&lt;head&gt;</span>\n    <span class="nt">&lt;title&gt;</span>Eduardo Mendes<span class="nt">&lt;/title&gt;</span>\n    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css&quot;</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;/head&gt;</span>\n  <span class="nt">&lt;body&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;jumbotron&quot;</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;https://avatars.githubusercontent.com/u/6801122?v=3&amp;amp;s=128&quot;</span> <span class="na">alt=</span><span class="s">&quot;Eduardo Mendes&quot;</span> <span class="na">class=</span><span class="s">&quot;img-circle&quot;</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;h1&gt;</span>Eduardo Mendes<span class="nt">&lt;/h1&gt;</span>\n        <span class="nt">&lt;p&gt;</span>Apaixonado por software livre e criador de lambdas.<span class="nt">&lt;/p&gt;</span>\n        <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">class=</span><span class="s">&quot;btn btn-primary btn-lg&quot;</span> <span class="na">href=</span><span class="s">&quot;http://github.com/z4r4tu5tr4&quot;</span><span class="err">\n</span>            <span class="na">role=</span><span class="s">&quot;button&quot;</span><span class="nt">&gt;</span>Me siga no GitHub<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/body&gt;</span>\n<span class="nt">&lt;/html&gt;</span>&#39;

======================================================================
FAIL: test_link (__main__.TestHome)
----------------------------------------------------------------------
Traceback (most recent call last):
  File &quot;tests.py&quot;, line 34, in test_link
    self.assertIn(&#39;href=&quot;http://twitter.com/cuducos&quot;&#39;, response_str)
AssertionError: &#39;href=&quot;http://twitter.com/cuducos&quot;&#39; not found in &#39;<span class="cp">&lt;!DOCTYPE HTML&gt;</span>\n<span class="nt">&lt;html&gt;</span>\n  <span class="nt">&lt;head&gt;</span>\n    <span class="nt">&lt;title&gt;</span>Eduardo Mendes<span class="nt">&lt;/title&gt;</span>\n    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href=</span><span class="s">&quot;https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css&quot;</span><span class="nt">&gt;</span>\n  <span class="nt">&lt;/head&gt;</span>\n  <span class="nt">&lt;body&gt;</span>\n    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>\n      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;jumbotron&quot;</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">&quot;https://avatars.githubusercontent.com/u/6801122?v=3&amp;amp;s=128&quot;</span> <span class="na">alt=</span><span class="s">&quot;Eduardo Mendes&quot;</span> <span class="na">class=</span><span class="s">&quot;img-circle&quot;</span><span class="nt">&gt;</span>\n        <span class="nt">&lt;h1&gt;</span>Eduardo Mendes<span class="nt">&lt;/h1&gt;</span>\n        <span class="nt">&lt;p&gt;</span>Apaixonado por software livre e criador de lambdas.<span class="nt">&lt;/p&gt;</span>\n        <span class="nt">&lt;p&gt;&lt;a</span> <span class="na">class=</span><span class="s">&quot;btn btn-primary btn-lg&quot;</span> <span class="na">href=</span><span class="s">&quot;http://github.com/z4r4tu5tr4&quot;</span><span class="err">\n</span>            <span class="na">role=</span><span class="s">&quot;button&quot;</span><span class="nt">&gt;</span>Me siga no GitHub<span class="nt">&lt;/a&gt;&lt;/p&gt;</span>\n      <span class="nt">&lt;/div&gt;</span>\n    <span class="nt">&lt;/div&gt;</span>\n  <span class="nt">&lt;/body&gt;</span>\n<span class="nt">&lt;/html&gt;</span>&#39;

----------------------------------------------------------------------
Ran 6 tests in 0.024s

FAILED (failures=2)
</pre></div>


<p>Os testes nos dizem que bagunçamos as informações. Os testes de conteúdo não encontram mais <code>Eduardo Cuducos</code> na página, nem o link para <code>http://twitter.com/cuducos</code>.</p>
<p>Vamos arrumar isso fazendo um caso de teste para cada perfil. Vamos mudar também nosso esquema de URL. Ao invés de testar a raíz da aplicação, vamos testar se em <code>/nome-do-usuário</code> vemos as informações desse usuário.</p>
<p>Vamos renomear <code>TestGet</code> para <code>TestCuducos</code> e mudar a URL no <code>setUp()</code>:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestCuducos</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">meu_web_app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/cuducos&#39;</span><span class="p">)</span>
</pre></div>


<p>Agora podemos duplicar toda essa classe renomeando-a para <code>TestZ4r4tu5tr4</code>, substituindo as informações pertinentes:</p>
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestZ4r4tu5tr4</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">meu_web_app</span><span class="o">.</span><span class="n">test_client</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;/z4r4tu5tr4&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">content_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;title&gt;Eduardo Mendes&lt;/title&gt;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">response_str</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;Eduardo Mendes&lt;/h1&gt;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">response_str</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;Apaixonado por software livre&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">response_str</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">test_bootstrap_css</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;bootstrap.min.css&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_profile_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;img src=&quot;&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;class=&quot;img-circle&quot;&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;href=&quot;http://github.com/z4r4tu5tr4&quot;&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&gt;Me siga no GitHub&lt;/a&gt;&#39;</span><span class="p">,</span> <span class="n">response_str</span><span class="p">)</span>
</pre></div>


<p>Testes prontos… e falhando, claro. Não mudamos nosso esquema de URLs no Flask. Voltemos ao <code>app.py</code>.</p>
<p>Podemos começar com algo repetitivo, mas simples:</p>
<div class="highlight"><pre><span></span><span class="nv">@meu_web_app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/cuducos&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">pagina_inicial_cuducos</span><span class="p">()</span><span class="err">:</span><span class="w"></span>
<span class="w">    </span><span class="n">perfil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PERFIS</span><span class="o">[</span><span class="n">&#39;cuducos&#39;</span><span class="o">]</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">perfil</span><span class="o">=</span><span class="n">perfil</span><span class="p">)</span><span class="w"></span>


<span class="nv">@meu_web_app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/z4r4tu5tr4&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">pagina_inicial_z4r4tu5tr4</span><span class="p">()</span><span class="err">:</span><span class="w"></span>
<span class="w">    </span><span class="n">perfil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PERFIS</span><span class="o">[</span><span class="n">&#39;z4r4tu5tr4&#39;</span><span class="o">]</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">perfil</span><span class="o">=</span><span class="n">perfil</span><span class="p">)</span><span class="w"></span>
</pre></div>


<p>Como resultado, temos nossa aplicação com conteúdo dinâmico, com testes passando e funcionando!</p>
<p>Podemos melhorar um pouco mais. Essa repetição dos métodos <code>pagina_inicial_cuducos()</code> e <code>pagina_inicial_z4r4tu5tr4()</code> é facilmente evitada no Flask:</p>
<div class="highlight"><pre><span></span><span class="nv">@meu_web_app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&lt;perfil&gt;&#39;</span><span class="p">)</span><span class="w"></span>
<span class="n">def</span><span class="w"> </span><span class="n">pagina_inicial</span><span class="p">(</span><span class="n">perfil</span><span class="p">)</span><span class="err">:</span><span class="w"></span>
<span class="w">    </span><span class="n">perfil</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PERFIS</span><span class="o">[</span><span class="n">perfil</span><span class="o">]</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;home.html&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">perfil</span><span class="o">=</span><span class="n">perfil</span><span class="p">)</span><span class="w"></span>
</pre></div>


<p>Agora o Flask recebe uma variável <code>perfil</code> depois da <code>/</code> (e sabemos que é uma variável pois envolvemos o nome <code>perfil</code> entre os sinais de <code>&lt;</code> e <code>&gt;</code>). E utilizamos essa variável para escolher qual perfil passar para nosso tempate.</p>
<h2>Considerações finais</h2>
<p>Se chegou até aqui, vale a pena ressaltar que esse post tem apenas o objetivo de introduzir a ideia básica do TDD. Ou seja: ver como o hábito, o método de programar pouco a pouco (<em>baby steps</em>) e sempre começando com os testes te dão dois benefícios sensacionais: eles não só garantem que a aplicação funcionará como esperado, mas eles guiam o próprio processo de desenvolvimento. As mensagens de erro te dizer – muitas vezes literalmente — o qual é a próxima linha de código que você vai escrever.</p>
<p>E, se chegou até aqui, talvez você queira se aprofundar nos assuntos dos quais falamos. Além de inúmeros posts aqui do blog, ressalto mais algumas referências.</p>
<p>Leituras recomendadas para conhecer mais sobre Flask:</p>
<ul>
<li>Em português: <a href="http://pythonclub.com.br/what-the-flask-pt-1-introducao-ao-desenvolvimento-web-com-python">Tutorial</a> (ainda incompleto) do <a href="https://twitter.com/rochacbruno">Bruno Rocha</a></li>
<li>Em inglês: <a href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Tutorial</a> ou <a href="http://flaskbook.com">livro</a> do <a href="https://twitter.com/miguelgrinberg">Miguel Grinberg</a></li>
</ul>
<p>Leitura recomendada para conhecer mais sobre TDD:</p>
<ul>
<li>Em inglês: <a href="http://shop.oreilly.com/product/0636920029533.do">Livro</a> do <a href="https://twitter.com/hjwp">Harry Percival</a></li>
<li>Em inglês: essa <a href="http://stackoverflow.com/questions/4904096/whats-the-difference-between-unit-functional-acceptance-and-integration-test/4904533#4904533">resposta</a> no Stack Overflow sobre <em>unit</em>, <em>integration</em>, <em>functional</em> e <em>acceptance test</em>.</li>
</ul>
<blockquote>
<p>Quem aprendeu alguma coisa nova?</p>
<p>— <a href="https://twitter.com/raymondh">Raymond Hettinger</a></p>
</blockquote>

            <div class="licence">
                <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Licença Creative Commons"
                                                                                               style="border-width:0"
                                                                                               src="http://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png"/></a><br/><a
                    xmlns:dct="http://purl.org/dc/terms/" property="dct:title"
                    href="http://pythonclub.com.br/tdd-com-python-e-flask.html">"TDD com Python e Flask"</a> de <a
                    xmlns:cc="http://creativecommons.org/ns#" href="http://pythonclub.com.br/author/eduardo-cuducos.html"
                    property="cc:attributionName" rel="cc:attributionURL">"Eduardo Cuducos"</a> está licenciado com uma Licença
                <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons -
                    Atribuição-NãoComercial-SemDerivações 4.0 Internacional</a>.
            </div>

            <div class="sharing">
                <!-- Facebook sharing -->
                <div id="fb-root"></div>
                <script>(function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "//connect.facebook.net/pt_BR/sdk.js#xfbml=1&appId=1487080281503641&version=v2.0";
                fjs.parentNode.insertBefore(js, fjs);
                }(document, 'script', 'facebook-jssdk'));</script>
                <div class="fb-share-button" data-href="http://pythonclub.com.br/tdd-com-python-e-flask.html" data-type="button_count"></div>

                <!-- Google+ sharing -->
                <div class="g-plus alinhar" data-action="share" data-annotation="bubble" data-href="http://pythonclub.com.br/tdd-com-python-e-flask.html"></div>

                <!-- Twitter sharing -->
                <a href="https://twitter.com/share" class="twitter-share-button" data-lang="pt" style="margin-bottom: -4px !important;">Tweetar</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
            </div>

            <div class="hr"></div>
            <a href="#" class="go-top">Topo</a>
                <div class="comments">
                    <div id="disqus_thread"></div>
                    <script type="text/javascript">
                        /* * * CONFIGURATION VARIABLES: THIS CODE IS ONLY AN EXAMPLE * * */
                        var disqus_shortname = 'pythonclub'; // Required - Replace example with your forum shortname
                        var disqus_identifier = 'tdd-com-python-e-flask.html';
                        var disqus_title = 'TDD com Python e Flask';
                        var disqus_url = 'http://pythonclub.com.br/tdd-com-python-e-flask.html';
                    
                        /* * * DON'T EDIT BELOW THIS LINE * * */
                        (function() {
                            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                        })();
                    </script>
                    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                </div>
<footer class="footer">
    <p>&copy; PythonClub &ndash;
        Built with <a href="https://github.com/PurePelicanTheme/pure">Pure Theme</a>
        for <a href="http://blog.getpelican.com/">Pelican</a>
    </p>
</footer>        </div>
    </div>
</div>


    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="http://pythonclub.com.br/theme/js/dynamic_random_articles.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
        $(window).load(function(){
          $("iframe").css("margin-bottom", "-6px")
          $("#twitter-widget-0").css("margin-bottom", "-5px");
          $("#twitter-widget-0").css("margin-left", "-1px");
        });
    </script>
    <script type="text/javascript" src="https://apis.google.com/js/platform.js">
      {lang: 'pt-BR'}
    </script>

    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });

        $(function(){
            show_random_articles($('#random-articles'), [{"url": "http://pythonclub.com.br/encapsulamento-da-logica-do-algoritmo.html", "title": "Encapsulamento da l\u00f3gica do algoritmo"}, {"url": "http://pythonclub.com.br/fazendo-backup-do-banco-de-dados-no-django.html", "title": "Fazendo backup do banco de dados no Django"}, {"url": "http://pythonclub.com.br/django-ci-github-actions.html", "title": "Criando um CI de uma aplica\u00e7\u00e3o Django usando Github Actions"}, {"url": "http://pythonclub.com.br/crie_dict-a-partir-de-outros-dicts.html", "title": "Criando dicts a partir de outros dicts"}, {"url": "http://pythonclub.com.br/tutorial-django-2.html", "title": "Tutorial Django 2.2"}, {"url": "http://pythonclub.com.br/algoritmos-ordenacao.html", "title": "Algoritmos de Ordena\u00e7\u00e3o"}, {"url": "http://pythonclub.com.br/trabalhando-com-operadores-ternarios.html", "title": "Trabalhando com operadores tern\u00e1rios"}, {"url": "http://pythonclub.com.br/upload-de-arquivos-com-socket-e-struct.html", "title": "Upload de Arquivos com Socket e Struct"}, {"url": "http://pythonclub.com.br/monitorando-ips-duplicados-na-rede.html", "title": "Monitorando Ips Duplicados na Rede"}, {"url": "http://pythonclub.com.br/django-rest-framework-class-based-views.html", "title": "Django Rest Framework - #3 Class Based Views"}, {"url": "http://pythonclub.com.br/django-rest-framework-requests-responses.html", "title": "Django Rest Framework - #2 Requests and Responses"}, {"url": "http://pythonclub.com.br/progrmacao-funcional-com-python-2.html", "title": "Programa\u00e7\u00e3o funcional com Python #2 - Iteraveis e iteradores"}, {"url": "http://pythonclub.com.br/progrmacao-funcional-com-python-1.html", "title": "Programa\u00e7\u00e3o funcional com Python #1 - Fun\u00e7\u00f5es"}, {"url": "http://pythonclub.com.br/progrmacao-funcional-com-python-0.html", "title": "Programa\u00e7\u00e3o funcional com Python #0 - Saindo da zona de conforto"}, {"url": "http://pythonclub.com.br/peewee-um-orm-python-minimalista.html", "title": "Peewee - Um ORM Python minimalista"}, {"url": "http://pythonclub.com.br/what-the-flask-pt-4-extensoes-para-o-flask.html", "title": "What the Flask? pt 4 - Extens\u00f5es para o Flask"}, {"url": "http://pythonclub.com.br/configurando-python-3.5-openshift-flask-gunicorn.html", "title": "Configurando OpenShift com Python 3.5 + Flask + Gunicorn"}, {"url": "http://pythonclub.com.br/instalando-o-python-vers\u00e3o-3.7.0-alpha-1-no-ubuntu-16.04.md.html", "title": "Instalando o Python vers\u00e3o 3.7.0 alpha 1 no Ubuntu 16.04"}, {"url": "http://pythonclub.com.br/abrangencia-de-listas-e-dicionarios-com-python.html", "title": "Abrang\u00eancia de Listas e Dicion\u00e1rios"}, {"url": "http://pythonclub.com.br/debugging-logging.html", "title": "Debugging - logging"}, {"url": "http://pythonclub.com.br/deploy-rapido-simples-com-dokku.html", "title": "Deploy r\u00e1pido e simples com Dokku"}, {"url": "http://pythonclub.com.br/bot-telegram-mais-web-scraping-parte-1.html", "title": "Bot telegram mais web scraping - parte 1"}, {"url": "http://pythonclub.com.br/como-distribuir-sua-aplicacao-python-com-pypi.html", "title": "Como distribuir sua aplica\u00e7\u00e3o Python com PyPI"}, {"url": "http://pythonclub.com.br/python-webassets-elm.html", "title": "Python webassets & Elm"}, {"url": "http://pythonclub.com.br/curso-asyncio-aula1.html", "title": "Curso Python asyncio: Aula 01 - Iterators e Generators"}, {"url": "http://pythonclub.com.br/curso-asyncio-aula00.html", "title": "Curso Python asyncio: Aula 00 - Introdu\u00e7\u00e3o ao m\u00f3dulo asyncio"}, {"url": "http://pythonclub.com.br/gerando-relatorios-de-testes-com-coveralls.html", "title": "Relat\u00f3rios de testes com Coveralls"}, {"url": "http://pythonclub.com.br/python-com-unittest-travis-ci-coveralls-e-landscape-parte-4-de-4.html", "title": "Python com Unittest, Travis CI, Coveralls e Landscape (Parte 4 de 4)"}, {"url": "http://pythonclub.com.br/python-com-unittest-travis-ci-coveralls-e-landscape-parte-3-de-4.html", "title": "Python com Unittest, Travis CI, Coveralls e Landscape (Parte 3 de 4)"}, {"url": "http://pythonclub.com.br/python-com-unittest-travis-ci-coveralls-e-landscape-parte-2-de-4.html", "title": "Python com Unittest, Travis CI, Coveralls e Landscape (Parte 2 de 4)"}, {"url": "http://pythonclub.com.br/python-com-unittest-travis-ci-coveralls-e-landscape-parte-1-de-4.html", "title": "Python com Unittest, Travis CI, Coveralls e Landscape (Parte 1 de 4)"}, {"url": "http://pythonclub.com.br/github-pages-com-pelican-e-travis-ci.html", "title": "GitHub Pages com Pelican e Travis-CI"}, {"url": "http://pythonclub.com.br/sites-estaticos-com-lektor.html", "title": "Sites Est\u00e1ticos com Lektor"}, {"url": "http://pythonclub.com.br/django-rest-framework-serialization.html", "title": "Django Rest Framework Serialization"}, {"url": "http://pythonclub.com.br/explicit-is-better-than-implicit.html", "title": "Explicit is better than implicit"}, {"url": "http://pythonclub.com.br/tdd-com-python-e-flask.html", "title": "TDD com Python e Flask"}, {"url": "http://pythonclub.com.br/upload-de-arquivos-no-django-entendendo-os-modos-de-leitura.html", "title": "Upload de arquivos no Django: entendendo os modos de leitura"}, {"url": "http://pythonclub.com.br/python-generators.html", "title": "Python Generators"}, {"url": "http://pythonclub.com.br/paralelismo-em-python-usando-concurrent.futures.html", "title": "Paralelismo em Python usando concurrent.futures"}, {"url": "http://pythonclub.com.br/salvando-grafico-github-python-selenium.html", "title": "Salvando gr\u00e1fico de contribui\u00e7\u00f5es do Github com Python e Selenium"}, {"url": "http://pythonclub.com.br/como-encontrar-solucoes-python.html", "title": "Como encontrar solu\u00e7\u00f5es para seus problemas com Python"}, {"url": "http://pythonclub.com.br/criando-novos-comandos-no-django-admin.html", "title": "Criando novos comandos no django-admin"}, {"url": "http://pythonclub.com.br/extraindo-texto-de-imagens-com-python.html", "title": "Extraindo Texto de Imagens com Python"}, {"url": "http://pythonclub.com.br/django-rest-framework-quickstart.html", "title": "Django Rest Framework Quickstart"}, {"url": "http://pythonclub.com.br/material-do-tutorial-web-scraping-na-nuvem.html", "title": "Web Scraping na Nuvem com Scrapy"}, {"url": "http://pythonclub.com.br/class-based-views-django.html", "title": "Class Based Views no Django"}, {"url": "http://pythonclub.com.br/django-na-pratica-aula-01.html", "title": "Django na pr\u00e1tica - Hello World"}, {"url": "http://pythonclub.com.br/what-the-flask-pt-3-plug-use-extensoes-essenciais-para-iniciar-seu-projeto.html", "title": "What the Flask? Pt-3 Plug & Use - extens\u00f5es essenciais para iniciar seu projeto"}, {"url": "http://pythonclub.com.br/raspando-a-web-com-python-parte-1.html", "title": "Raspando a Web com Python: Introdu\u00e7\u00e3o"}, {"url": "http://pythonclub.com.br/instalando-pycharm-ubuntu.html", "title": "Instalando o PyCharm no Ubuntu (e irm\u00e3os)"}, {"url": "http://pythonclub.com.br/a-armadilha-dos-argumentos-com-valores-padrao.html", "title": "A armadilha dos argumentos com valores padr\u00e3o"}, {"url": "http://pythonclub.com.br/desenvolvendo-para-google-app-engine-com-tekton.html", "title": "Cria\u00e7\u00e3o de aplica\u00e7\u00f5es no Google App Engine com o Tekton"}, {"url": "http://pythonclub.com.br/django-introducao-queries.html", "title": "Como otimizar suas consultas no Django - De N a 1 em 20 minutos"}, {"url": "http://pythonclub.com.br/django-overview-10-minutos.html", "title": "Django - 3 anos em 10 minutos"}, {"url": "http://pythonclub.com.br/configurando-ambiente-django-com-apache-e-mod-wsgi.html", "title": "Configurando ambiente Django com Apache e mod_wsgi"}, {"url": "http://pythonclub.com.br/tuplas-mutantes-em-python.html", "title": "Tuplas mutantes em Python"}, {"url": "http://pythonclub.com.br/postgresql-e-django.html", "title": "PostgreSql e Django - parte 3"}, {"url": "http://pythonclub.com.br/postgresql-e-python3.html", "title": "PostgreSql e Python3 - parte 2"}, {"url": "http://pythonclub.com.br/microframework-contra-baterias-incluidas.html", "title": "Microframework contra &quot;Baterias Inclu\u00eddas&quot;"}, {"url": "http://pythonclub.com.br/debugging-em-python-sem-ide.html", "title": "Debugging em python (sem IDE)"}, {"url": "http://pythonclub.com.br/tutorial-postgresql.html", "title": "Tutorial PostgreSql - parte 1"}, {"url": "http://pythonclub.com.br/conteinerizando-suas-aplicacoes-django-com-docker-e-fig.html", "title": "Conteinerizando suas aplica\u00e7\u00f5es django com docker e fig"}, {"url": "http://pythonclub.com.br/publicando-seu-hello-world-no-heroku.html", "title": "Publicando seu Hello World no Heroku"}, {"url": "http://pythonclub.com.br/entrevista-henrique-bastos.html", "title": "Entrevista com Henrique Bastos"}, {"url": "http://pythonclub.com.br/testes-de-carga-com-o-locust.html", "title": "Testes de carga com o Locust"}, {"url": "http://pythonclub.com.br/tutorial-django-17.html", "title": "Tutorial Django 1.7"}, {"url": "http://pythonclub.com.br/integrando-django-com-cloudinary.html", "title": "Integrando o Django com Cloudinary"}, {"url": "http://pythonclub.com.br/bottle-framework-full-stack-sem-django.html", "title": "Bottle Framework full stack sem Django"}, {"url": "http://pythonclub.com.br/desenvolvendo-com-bottle-parte-1.html", "title": "Desenvolvendo com Bottle - Parte 1"}, {"url": "http://pythonclub.com.br/gerenciando-banco-dados-sqlite3-python-parte2.html", "title": "Gerenciando banco de dados SQLite3 com Python - Parte 2"}, {"url": "http://pythonclub.com.br/solucao-quase-definitiva-para-permissoes-em-projetos-django.html", "title": "Solu\u00e7\u00e3o (quase) definitiva para permiss\u00f5es em projetos Django"}, {"url": "http://pythonclub.com.br/gerenciando-assets-com-django-pipeline.html", "title": "Gerenciando assets com django-pipeline"}, {"url": "http://pythonclub.com.br/deploy-app-django-openshift.html", "title": "Deploy App Django no Openshift"}, {"url": "http://pythonclub.com.br/criando-sites-estaticos-com-pelican.html", "title": "Criando sites est\u00e1ticos com Pelican Framework"}, {"url": "http://pythonclub.com.br/selenium-parte-4.html", "title": "Selenium - O que voc\u00ea deveria saber - Parte 4"}, {"url": "http://pythonclub.com.br/configurando-um-servidor-de-producao-para-aplicacoes-python.html", "title": "Configurando um servidor de produ\u00e7\u00e3o para aplica\u00e7\u00f5es Python"}, {"url": "http://pythonclub.com.br/what-the-flask-pt-2-flask-patterns-boas-praticas-na-estrutura-de-aplicacoes-flask.html", "title": "What the Flask? Pt-2 Flask Patterns - boas pr\u00e1ticas na estrutura de aplica\u00e7\u00f5es Flask"}, {"url": "http://pythonclub.com.br/gerenciando-banco-dados-sqlite3-python-parte1.html", "title": "Gerenciando banco de dados SQLite3 com Python - Parte 1"}, {"url": "http://pythonclub.com.br/introducao-classes-metodos-python-basico.html", "title": "Introdu\u00e7\u00e3o a Classes e M\u00e9todos em Python (b\u00e1sico)"}, {"url": "http://pythonclub.com.br/pyftpdlib-criando-um-servidor-ftp-simples-com-python.html", "title": "pyftpdlib - Criando um servidor FTP simples com python"}, {"url": "http://pythonclub.com.br/usando-redis-cache-django.html", "title": "Usando Redis para cache e sess\u00e3o do Django"}, {"url": "http://pythonclub.com.br/aprendendo-e-ensinando-python.html", "title": "Aprendendo e Ensinando Python"}, {"url": "http://pythonclub.com.br/selenium-parte-3.html", "title": "Selenium - O que voc\u00ea deveria saber - Parte 3"}, {"url": "http://pythonclub.com.br/what-the-flask-pt-1-introducao-ao-desenvolvimento-web-com-python.html", "title": "What the Flask? Pt-1 Introdu\u00e7\u00e3o ao desenvolvimento web com Python"}, {"url": "http://pythonclub.com.br/selenium-parte-2.html", "title": "Selenium - O que voc\u00ea deveria saber - Parte 2"}, {"url": "http://pythonclub.com.br/guia-rapido-comandos-sqlite3.html", "title": "Guia r\u00e1pido de comandos SQLite3"}, {"url": "http://pythonclub.com.br/editando-o-admin-do-django.html", "title": "Editando o Admin do Django"}, {"url": "http://pythonclub.com.br/instalacao-python-django-windows.html", "title": "Instalando e Configurando o Python e Django no Windows"}, {"url": "http://pythonclub.com.br/criar-site-com-form-lista-30-min.html", "title": "Como criar um site com formul\u00e1rio e lista em 30 minutos?"}, {"url": "http://pythonclub.com.br/principais-duvidas-de-quem-quer-aprender-django.html", "title": "Principais d\u00favidas de quem quer aprender Django"}, {"url": "http://pythonclub.com.br/parseando-sites-com-beautifulsoup.html", "title": "Exemplo de como &quot;Parsear&quot; Sites com BeautifulSoup"}, {"url": "http://pythonclub.com.br/deploy-com-django-fagungis.html", "title": "Publica\u00e7\u00e3o de projetos com o Django-Fagungis"}, {"url": "http://pythonclub.com.br/como-fazer-fork-clone-push-pull-request-no-github.html", "title": "Como fazer fork, clone, push pull-request no Github"}, {"url": "http://pythonclub.com.br/primeiro-projeto-django-no-linux-com-sublime.html", "title": "Seu primeiro projeto Django com Sublime Text no Linux"}, {"url": "http://pythonclub.com.br/introducao-a-testes-funcionais-com-selenium-e-python.html", "title": "Introdu\u00e7\u00e3o a testes funcionais com Selenium e Python"}, {"url": "http://pythonclub.com.br/selenium-parte-1.html", "title": "Selenium - O que voc\u00ea deveria saber - Parte 1"}, {"url": "http://pythonclub.com.br/5-django-apps-que-nao-vivo-se.html", "title": "5 Django Apps que n\u00e3o vivo sem"}, {"url": "http://pythonclub.com.br/sobre-o-six-e-como-ele-ajuda-a-escrever-codigo-compativel-com-python-2-e-3.html", "title": "Sobre o six e como ele ajuda a escrever c\u00f3digo compat\u00edvel com python 2 e 3"}, {"url": "http://pythonclub.com.br/como_colaborar_com_projetos_open_source.html", "title": "Como colaborar na tradu\u00e7\u00e3o do Djangobook sem conhecer programa\u00e7\u00e3o"}], 10);
        });
        
    </script>
        <!-- spot_im -->
        <!--    <div id="spot-im-root"></div> -->
        <!--    <script type="text/javascript">!function(t,o,p){function e(){var t=o.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"==o.location.protocol?"https":"http")+":"+p,o.body.appendChild(t)}t.spotId="3de816246c80a51757bb01c5b8c95cda",t.spotName="",t.allowDesktop=!0,t.allowMobile=!1,t.containerId="spot-im-root",e()}(window.SPOTIM={},document,"//www.spot.im/embed/scripts/launcher.js");</script> -->
        <!-- end spot_im -->
   
            <script>
              ((window.gitter = {}).chat = {}).options = {
                    room: 'pythonclub/pythonclub.github.io'
              };
            </script>
            <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
   
</body>
</html>